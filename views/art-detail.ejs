<%- include('layouts/innerheader'); -%>
<style>
.detail_cont {
    background: #fff;
    padding: 20px !important;
    width: 100%;
    margin: 30px 50px 50px 50px;
    width: 95%;
}
.imgw img{
    width: 60px;
    padding-right: 10px;}
.bgh{
    background-color: #f3f5f6;
    padding: 15px 30px;
	margin:5px 0px;
	    display: inline-flex;
    width: 100%;
	}
.pdlft0{
padding-left:0;}
.title.text-dark{
    font-size: 35px;
    padding-bottom: 10px;
}

</style>
<body onload = "dateCheck()">
    
	<div class="flex_div_bread">
    <div class="pdhs">
       <svg class="svgt" _ngcontent-ng-c3832377555="" width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path _ngcontent-ng-c3832377555="" d="M1.42393 16H15.5759C15.6884 16 15.7962 15.9584 15.8758 15.8844C15.9553 15.8104 16 15.71 16 15.6054V6.29143C16 6.22989 15.9846 6.1692 15.9549 6.11422C15.9252 6.05923 15.8821 6.01147 15.829 5.97475L8.75305 1.07803C8.67992 1.02736 8.59118 1 8.5 1C8.40882 1 8.32008 1.02736 8.24695 1.07803L1.17098 5.97587C1.11791 6.01259 1.0748 6.06035 1.04511 6.11534C1.01543 6.17033 0.999976 6.23101 1 6.29255V15.6063C1.00027 15.7108 1.04504 15.8109 1.12451 15.8847C1.20398 15.9585 1.31165 16 1.42393 16ZM10.1464 15.2107H6.85241V10.6202H10.1464V15.2107ZM1.84866 6.48977L8.4999 1.88561L15.1517 6.48977V15.2107H10.9946V10.2256C10.9946 10.1209 10.95 10.0206 10.8704 9.94654C10.7909 9.87254 10.683 9.83096 10.5705 9.83096H6.42848C6.316 9.83096 6.20812 9.87254 6.12858 9.94654C6.04904 10.0206 6.00435 10.1209 6.00435 10.2256V15.2107H1.84806L1.84866 6.48977Z" fill="#55585B" stroke="#55585B" stroke-width="0.5"></path></svg> <span class="hme"><a href="/welcome">Home</a></span><span class="bread_div">/</span><span class="hme">Art Details</span>
    </div>
	
</div>
	
	
    <% if (errors.length > 0) { %>
      <div class="alert alert-danger alert-dismissible">
          <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
          <%= errors[0] %>
          </div>
      </div>
  <% } %>
  <% if (success.length > 0) { %>
      <div class="alert alert-success alert-dismissible" style="
      margin-top: 35px;
      padding-bottom: -8px;
      width: 83%;
      margin-left: 98px;
  ">
          <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
          <%= success[0] %>
          </div>
      </div>
  <% } %>
     <section class="py-5 detail_cont">
        <div class="container-fluid">
          <div class="row gx-5">
            <aside class="col-lg-6">
               
                <a data-fslightbox="mygalley" class="rounded-4" target="_blank" data-type="image" href="/<%= art[0].art[0].image %>">
                  <img style="    width: 100%;
    height: 700px;
    object-fit: cover;" class="rounded-4 fit" src="/<%= art[0].art[0].image %>" />
                </a>
               
              
              <!-- thumbs-wrap.// -->
              <!-- gallery-wrap .end// -->
            </aside>
            <div class="col-lg-6">
              <div class="ps-lg-3">
                <h4 class="title text-dark">
                    <b><%= art[0].art[0].title %></b>
                </h4>
                
      
                <div class="mb-3">
                  <span class="h5 pdlft0 min_bid_amount">Base value: $<%= art[0].art[0].min_bid %></span>
                  <span class="text-muted"></span>
                </div>

                <div class="mb-3">
                    <span class="h5 pdlft0 min_bid_amount">Last Bid: $<%= art[0].art[0].last_bid %></span>
                    <span class="text-muted"></span>
                  </div>
      
                <p class="desc">
                    <%= art[0].art[0].description %>
                </p>
      
                <div class="row">
                <div class="col-md-12">                 
					
					<div class="start_d bgh">
					
					<div class="imgw">
						<img src="/images/timer.png">
					</div>
					<div class="imgws">
					<div class="fdh">Starts at</div>
					<div class="fdhs"><%= art[0].art[0].start_date %> <%= moment(art[0].art[0].start_time, ["h:mm A"]).format('hh:mm A') %></div>
					</div>
				</div>
				
				<div class="start_d sfpd bgh">
				<div class="imgw">
						<img src="/images/timer.png">
					</div>
					<div class="imgws">
					<div class="fdh">Ends at</div>
					<div class="fdhs"><%= art[0].art[0].end_date %> <%= moment(art[0].art[0].end_time, ["h:mm A"]).format('hh:mm A') %></div>
				</div>
				</div>
				
				
				<div class="start_d sfpd bgh">
				<div class="imgw">
						<img src="/images/user.png">
					</div>
					<div class="imgws">
                  <div class="fdh">Posted By</div>
                  <div class="fdhs"><%= art[0].art[0].userData[0].userName %></div>
					
                </div>
                </div>
                    
                <% if (art[0].art[0].status != 'completed') { %>

                <div class="start_d sfpd bgh">
                  <div class="imgw">
                      <img src="/images/timer.png">
                    </div>
                    <% if (art[0].art[0].status == 'active') { %>
                      <div class="imgws">
                        <div class="fdh">Bid will Start In:</div>
                        <div class="fdhs"><span class="countdownTimerAllClass" style="display: block;"></span></div>
                      
                      <input type="hidden" class="countdowndate_from" value="<%= art[0].art[0].start_date %>">
                      <input type="hidden" class="countdowntime_from" value="<%= art[0].art[0].start_time %>">
                      </div>
                  <% }else{ %>
                    <div class="imgws">
                      <div class="fdh">Bid will End In:</div>
                      <div class="fdhs"><span class="countdownTimerAllClass" style="display: block;"></span></div>
                    
                    <input type="hidden" class="countdowndate_from" value="<%= art[0].art[0].end_date %>">
                    <input type="hidden" class="countdowntime_from" value="<%= art[0].art[0].end_time %>">
                    </div>
                  <% } %>
                    
                  </div>
                  <% } %>

                  </div>
				</div>
                </div>
      
                <hr />
                <% if (art[0].art[0].status != 'active') { %>
                <% if (logged_in_id != art[0].art[0].user_id) { %>
              <div class="col-md-12 pd-0"> 
                <input style="    margin-top: 0;" id="bid_amount" class="inputError inputSuccess" placeholder="Enter Your Bid Amount" min="1" type="text" name="bid_amount" onkeyup="success()" value = "">
                <h4 id="bidend" style="color:red;display: none;"><img src="/images/bid.png" style="width: 25px;"> Bidding Finished</h4>
                <input type="hidden" name="bidder" id="bidder" value="<%= art[0].art[0].last_bidder_id %>" />
                <input type="hidden" name="art_id" id="art_id" value="<%= art[0].art[0]._id %>" />
                <input type="hidden" name="logged_in" id="logged_in" value="<%= logged_in_id %>" />
                <input type="hidden" name="last_bid" id="last_bid" value="<%= art[0].art[0].last_bid %>" />
                <input type="hidden" name="art_title" id="art_title" value="<%= art[0].art[0].title %>" />
                <input type="hidden" name="cartData" id="cart" value="<%= cart.length %>" />
                <input type="hidden" name="StartDate" id="userdate" value="<%= art[0].art[0].end_date %> <%= art[0].art[0].end_time %>:00" />

              </div>
			
			<div class="uplokes">
              <a href="javascript:submitBid()" id="submitBid" class="alert-success shadow-0 submitBid" style="pointer-events: none;"> Submit </a>
			  </div>
              <span role="alert" class="requiredError" aria-hidden="true">
                Please enter Comment
            </span><br>
              <span role="alert" class="commentBidSuccess" aria-hidden1="true">
                Bid Submitted successfully
             </span><br>
              <% } %>


              <% if (logged_in_id == art[0].art[0].user_id) { %>
                <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Bid History</button>

                <!-- <a href="#" class="btn btn-warning shadow-0" data-toggle="modal" data-target="#myModal"> Bidding History </a> -->
                
              <% } %>
              <!-- <button type="button" id="buy" style="display: none;" class="btn btn-warning btn-lg" data-toggle="modal" data-target="#ignismyModal">Buy Now</button> -->

                <!-- <a href="#" id="buy" class="btn btn-warning shadow-0" style="display: none;" > Buy now </a> -->
                <a id="addcart" href="javascript:addToCart()" class="btn btn-primary shadow-0" style="display: none;"> <i class="me-1 fa fa-shopping-basket"></i> Add to cart </a>
                
                <span style="    font-size: 18px;
    padding-top: 20px;
    text-align: center;
    font-weight: bold;" role="alert" class="addedtocartSuccess" aria-hidden1="true">
                  Art successfully added in your cart.
               </span>
                <div id="alreadyadded" style="display: none;"><h4 style="font-size: 16px !important;">Already added to cart </h4><a  href="/cart" class="btn btn-primary shadow-0"> <i class="me-1 fa fa-shopping-basket"></i>View Cart </a></div>

                <% }else { %>

                    <h4 id="upcoming" style="font-weight: 900;
    
    font-size: 18px;
    padding: 5px 10px;" class="alert alert-danger">The bid has not commenced yet; it will initiate shortly.</h4>

                <% } %>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalScrollableTitle">Bid History</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">

                <table>
                    <tr>
                      <th>User Name</th>
                      <th>Bid Amount</th>
                    </tr>
                <% biddingHistory[0].biddingHistory.forEach(history => { %>

                    
                        <tr>
                          <td><%= history.userData[0].userName %></td>
                          <td><%= history.bid_amount %></td>
                         
                        </tr>
                        
                      

                <% }) %>   
                
            </table>

            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="ignismyModal" role="dialog" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label=""><span>×</span></button>
                 </div>
      
                <div class="modal-body">
                   
        <div class="thank-you-pop">
          <img src="http://goactionstations.co.uk/wp-content/uploads/2017/03/Green-Round-Tick.png" alt="">
          <h1>Thank You!</h1>
          <p>Your submission is received and we will contact you soon</p>
          <h3 class="cupon-pop">Your Id: <span>12345</span></h3>
          
         </div>
                     
                </div>
      
            </div>
        </div>
    </div>

   <script>
   
        function dateCheck() {
            var ToDate = new Date();
            var UserDate = document.getElementById("userdate").value;
            var logged_in = document.getElementById("logged_in").value;
            var bidder = document.getElementById("bidder").value;
            var cart = document.getElementById("cart").value;


            console.log(bidder , logged_in)


            if (new Date(UserDate).getTime() <= ToDate.getTime()) {
                document.getElementById('bid_amount').style.display = "none"
                document.getElementById('submitBid').style.display = "none"
                document.getElementById('bidend').style.display = "block"
                if(bidder == logged_in){

                    if(cart == 0){
                      document.getElementById('addcart').style.display = "block"
                      document.getElementById('buy').style.display = "block"
                    }else{

                        document.getElementById('alreadyadded').style.display = "block"

                    }

                }


            }
            
        }

        function success() {
	 if(document.getElementById("bid_amount").value =="") { 
            document.getElementById('submitBid').style.pointerEvents = 'none'; 
        } else { 
            document.getElementById('submitBid').style.pointerEvents = '';
        }
    }

    function submitBid(e) {

        const bid_amount = parseInt(document.getElementById('bid_amount').value);
        const last_bid = parseInt(document.getElementById('last_bid').value);
        const art_title = document.getElementById('art_title').value;


        const product_id = document.getElementById('art_id').value;
        var ToDate = new Date();


        var UserDate = document.getElementById("userdate").value;
        
        if (new Date(UserDate).getTime() <= ToDate.getTime()) {
            // alert('Bid duration is over. Please check other art works.');
            const userNameField = document.getElementsByClassName("inputError");
            document.getElementsByClassName("requiredError")[0].textContent = "Bid duration is over. Please check other art works.";
            const showRequiredErr = document.getElementsByClassName("requiredError");
            showRequiredErr[0].classList.add("visible");
            userNameField[0].classList.add("invalid");
            showRequiredErr[0].setAttribute("aria-hidden", false);
            showRequiredErr[0].setAttribute("aria-invalid", true);
            setTimeout(() => {
                showRequiredErr[0].classList.remove("visible");
                userNameField[0].classList.remove("invalid");
                showRequiredErr[0].setAttribute("aria-hidden", true);
                showRequiredErr[0].setAttribute("aria-invalid", false);
            }, "50000");
        }

        else if(bid_amount <= last_bid){

          //  alert('Please enter bid amount greater than previous bid'); 
          const userNameField = document.getElementsByClassName("inputError");
          document.getElementsByClassName("requiredError")[0].textContent = "Please enter bid amount greater than previous bid.";
            const showRequiredErr = document.getElementsByClassName("requiredError");
            // console.log(showRequiredErr,!userNameField[key],key)
            showRequiredErr[0].classList.add("visible");
            userNameField[0].classList.add("invalid");
            showRequiredErr[0].setAttribute("aria-hidden", false);
            showRequiredErr[0].setAttribute("aria-invalid", true);
            setTimeout(() => {
                showRequiredErr[0].classList.remove("visible");
                userNameField[0].classList.remove("invalid");
                showRequiredErr[0].setAttribute("aria-hidden", true);
                showRequiredErr[0].setAttribute("aria-invalid", false);
            }, "50000");
            
        }else{

            var form = $(this);
        // var actionUrl = form.attr('action');

        $.ajax({
            type: "POST",
            url: 'http://localhost:8081/submit-bid',
            data : {
                id : product_id,
                bid_amount : bid_amount,
                last_bid : last_bid, // will be accessible in $_POST['data1']
                art_title : art_title
            },
            success: function(data)
            {
              // alert('Bid Submitted successfully.'); 

                document.getElementById('bid_amount').value = "";

                // window.location.reload();
                    const userNameField = document.getElementsByClassName("inputSuccess");
                    const showRequiredSuccess = document.getElementsByClassName("commentBidSuccess");
                    // console.log(showRequiredSuccess,!userNameField[0],0)
                    showRequiredSuccess[0].classList.add("visible");
                    userNameField[0].classList.add("invalid");
                    showRequiredSuccess[0].setAttribute("aria-hidden1", false);
                    showRequiredSuccess[0].setAttribute("aria-invalid", true);
                    setTimeout(() => {
                        showRequiredSuccess[0].classList.remove("visible");
                        userNameField[0].classList.remove("invalid");
                        showRequiredSuccess[0].setAttribute("aria-hidden1", true);
                        showRequiredSuccess[0].setAttribute("aria-invalid", false);
                    }, "50000");
            }
        });

        }
       
}
    
function addToCart() {

const product_id = document.getElementById('art_id').value;

    var form = $(this);
// var actionUrl = form.attr('action');

$.ajax({
    type: "POST",
    url: 'http://localhost:8081/add-cart',
    data : {
        art_id : product_id,
    },
    success: function(data)
    {
      // alert('Art Added to Cart.'); 
      const showRequiredSuccess = document.getElementsByClassName("addedtocartSuccess");
      showRequiredSuccess[0].classList.add("visible");
      showRequiredSuccess[0].setAttribute("aria-hidden1", false);
      showRequiredSuccess[0].setAttribute("aria-invalid", true);
      setTimeout(() => {
          showRequiredSuccess[0].classList.remove("visible");
          showRequiredSuccess[0].setAttribute("aria-hidden1", true);
          showRequiredSuccess[0].setAttribute("aria-invalid", false);
          window.location.assign('/cart');
      }, "50000");
    }
});

}
   </script>
	
    <script>
      $('input').bind('input', function() {
          var c = this.selectionStart,
              r = /[^0-9 .]/gi,
              v = $(this).val();
          if(r.test(v)) {
            $(this).val(v.replace(r, ''));
            c--;
          }
          this.setSelectionRange(c, c);
      });
      const countdownTimerClassArr = document.getElementsByClassName("countdownTimerAllClass");
      var x = setInterval(
      function () {
          for (var i = 0; i < countdownTimerClassArr.length; i++) {
              var countDownDateFrom = document.getElementsByClassName("countdowndate_from")[i].value;
              var countDownTimeFrom = document.getElementsByClassName("countdowntime_from")[i].value;
              // countDownDate = new Date(endDate.innerHTML.replace(/-/g, "/")).getTime();
              var countDown = countdownTimerClassArr[i];
              var coundDownFromDateTime = countDownDateFrom + " " + countDownTimeFrom;
              // var countDownDate = new Date("2023-11-04 21:52").getTime();
              var countDownDate = new Date(coundDownFromDateTime).getTime();
              var now = new Date().getTime();
  
              var distance = countDownDate - now;
  
              var days = Math.floor(distance / (1000 * 60 * 60 * 24));
              var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
              var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
              var seconds = Math.floor((distance % (1000 * 60)) / 1000);
  
  
              countDown.innerHTML = (days + "d " + hours + "h "
                  + minutes + "m " + seconds + "s ");
  
              if (distance < 0) {
                  clearInterval(x);
                  countDown.innerHTML = "";
                  window.location.reload();
              }
          }
      }, 1000);
  </script>
</body>

<%- include('layouts/footer'); -%>